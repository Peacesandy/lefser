---
title: "Lefser finds features that have greatest differences between classes."
author: |
 | Asya Khleborodova, Ludwig Geistlinger, and Levi Waldron
 | <small>School of Public Health, City University of New York</small>
date: "July 22, 2020"
abstract: ""
email:
output:
  BiocStyle::html_document:
    toc: true
    toc_depth: 2
vignette: >
  % \VignetteIndexEntry{Lefser uses Kruskal-Wallis test, Wilcoxon-Rank Sum test, 
  and LDA to find features with the greatest effect sizes}
  % \VignetteEngine{knitr::rmarkdown}
---

```{r style, echo = FALSE, results = 'asis'}
knitr::opts_chunk$set(fig.align = "center")
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(cache=TRUE)
```

```{r setup, echo=FALSE}
suppressMessages(suppressWarnings(suppressPackageStartupMessages({
library(curatedMetagenomicData)
library(lefser)
})))
```

# Overview and example use of `lefser`

The `lefser` function can be used with either `SummarizedExperiment`
or `ExpressionSet` data.

Install and load `curatedMetagenomicData`. 

Set datasets:

```{r}
datasets <- curatedMetagenomicData("*metaphlan_bugs_list.stool*", counts=TRUE, dryrun = FALSE)
```

Select dataset[[8]]. Within the `ExpressionSet` data set GROUP column 
to contain class 0 or class 1, (e.g. _control_ and _adenoma_). Set BLOCK to
be a sublass of each class as 0 or 1 (e.g. _adult_ or _non-adult_).

```{r}
datasets[[8]]=datasets[[8]][,datasets[[8]]$study_condition!="adenoma"]
grp8=ifelse(datasets[[8]]$study_condition=="control",0,1)
datasets[[8]]$GROUP=grp8

blk8=ifelse(datasets[[8]]$age_category=="adult",0,1)
datasets[[8]]$BLOCK=blk8
```

The dataset[[8]] can now be used with lefser functions. There is the _lefserAnalysis_ function for extracting 
results in the form of dataframe, names of selected microorganisms and their effect size.

```{r}
results <- lefserAnalysis(dataset[[8]])
head(results)
```

The other function is _lefserPlot_ should be used to generate a plot of the results.

```{r}
lefserPlot(results)
```
